services:
  safe-agent:
    build:
      context: .
      dockerfile: Dockerfile
    image: safe-agent:latest
    container_name: safe-agent
    restart: unless-stopped
    network_mode: host
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      # Persistent agent data (SQLite, memory, etc.)
      - ${HOME}/.local/share/safe-agent:/data/safe-agent
      # Agent config (read-only)
      - ./config.toml:/config/safe-agent/config.toml:ro
      # Claude CLI profile directory â€” must be writable (Claude writes stats/debug)
      - ${CLAUDE_CONFIG_DIR:-${HOME}/.claude}:/home/agent/.claude
    env_file:
      - .env
    environment:
      - CLAUDE_CONFIG_DIR=/home/agent/.claude
      - HOME=/home/agent
